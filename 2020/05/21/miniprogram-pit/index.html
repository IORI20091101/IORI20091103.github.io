<!DOCTYPE html><html lang="zh-CN"><head><!-- hexo injector head_begin start --><link href="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/css/index.css" rel="stylesheet"/><!-- hexo injector head_begin end --><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="多弗朗明哥"><meta name="copyright" content="多弗朗明哥"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>小程序开发填坑 | 唐吉诃德的小站</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" href="https://cdn.darknights.cn/assets/images/favicon.ico"><link rel="mask-icon" href="https://cdn.darknights.cn/assets/images/favicon.ico" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"sdongzhi.com","root":"/","title":"唐吉诃德的小站","version":"1.6.2","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://el-bot-api.vercel.app/api/words/young"},"algolia":{"appID":"ZH3RNMJ8TX","apiKey":"d3c4e9cb3d4b25b901414d257a20d970","indexName":"Pages","hits":{"per_page":8}},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="alternate" href="/atom.xml" title="唐吉诃德的小站" type="application/atom+xml"><link rel="stylesheet" href="/styles/custom.css"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-107257239-1"></script><script>if (CONFIG.hostname === location.hostname) {
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-107257239-1');
}</script><script data-ad-client="ca-pub-2245427233262012" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(function(){
  var bp = document.createElement('script');
  var curProtocol = window.location.protocol.split(':')[0];
  if (curProtocol === 'https') {
    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else {
    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(bp, s);
})();</script><!-- Google Tag Manager --><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-M9KWR9L');</script><!-- End Google Tag Manager --><meta name="description" content="最近连续开发了几个小程序，总是有一些需要重复解决的问题，因此在此记录一下 自定义头部组件我们开发小程序的时候通常是用的统一的头部，一般是白底黑字或者简单定义一下背景色和文字颜色，比如这样在 page&#x2F;example.json 中定义 12345678&amp;#123;  &quot;usingComponents&quot;: &amp;#123;&amp;#125;,  &quot;navigationBarBack">
<meta property="og:type" content="article">
<meta property="og:title" content="小程序开发填坑">
<meta property="og:url" content="https://sdongzhi.com/2020/05/21/miniprogram-pit/index.html">
<meta property="og:site_name" content="唐吉诃德的小站">
<meta property="og:description" content="最近连续开发了几个小程序，总是有一些需要重复解决的问题，因此在此记录一下 自定义头部组件我们开发小程序的时候通常是用的统一的头部，一般是白底黑字或者简单定义一下背景色和文字颜色，比如这样在 page&#x2F;example.json 中定义 12345678&amp;#123;  &quot;usingComponents&quot;: &amp;#123;&amp;#125;,  &quot;navigationBarBack">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.darknights.cn/assets/images/in-post/miniprogram/code.png">
<meta property="og:image" content="https://cdn.darknights.cn/assets/images/in-post/miniprogram/example1.png">
<meta property="og:image" content="https://cdn.darknights.cn/assets/images/in-post/miniprogram/navigator.png">
<meta property="og:image" content="https://cdn.darknights.cn/assets/images/in-post/miniprogram/bar.png">
<meta property="og:image" content="https://cdn.darknights.cn/assets/images/in-post/miniprogram/error.png">
<meta property="article:published_time" content="2020-05-21T00:00:00.000Z">
<meta property="article:modified_time" content="2021-09-27T06:34:37.005Z">
<meta property="article:author" content="多弗朗明哥">
<meta property="article:tag" content="小程序">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.darknights.cn/assets/images/in-post/miniprogram/code.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="多弗朗明哥"><img width="96" loading="lazy" src="/images/avatar.jpeg" alt="多弗朗明哥"><span class="site-author-status" title="Looking for dawn.">🌑</span></a><div class="site-author-name"><a href="/about/">多弗朗明哥</a></div><a class="site-name" href="/about/site.html">唐吉诃德的小站</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">54</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">19</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">36</span></a></div><a class="site-state-item hty-icon-button" href="/about/#comment" title="留言板"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-clipboard-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/IORI20091101" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/iori20091101" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://t.me/donduffy" title="Telegram Channel" target="_blank" style="color:#0088CC"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-telegram-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:sdzzlyjy@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://travellings.link" title="Travelling" target="_blank" style="color:var(--hty-text-color)"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-train-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%A4%B4%E9%83%A8%E7%BB%84%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">自定义头部组件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B2%97%E6%9A%B4%E8%AE%A1%E7%AE%97%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">1.1.</span> <span class="toc-text">粗暴计算方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%BC%E5%A4%9A%E5%A4%9A-%E5%AE%98%E6%96%B9%E4%B8%8D%E7%A8%B3%E7%9A%84%E6%96%B9%E6%A1%88%E4%BA%8C"><span class="toc-number">1.2.</span> <span class="toc-text">拼多多+官方不稳的方案二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#swiper-%E9%AB%98%E5%BA%A6%E9%97%AE%E9%A2%98"><span class="toc-number">2.</span> <span class="toc-text">swiper 高度问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">2.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-number">2.2.</span> <span class="toc-text">方法二</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA"><span class="toc-number">3.</span> <span class="toc-text">统一请求拦截</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3"><span class="toc-number"></span> <span class="toc-text">参考文档</span></a></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://sdongzhi.com/2020/05/21/miniprogram-pit/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="多弗朗明哥"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="唐吉诃德的小站"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">小程序开发填坑<a class="post-edit-link" href="https://github.com/YunYouJun/yunyoujun.github.io/tree/hexo/source/_posts/miniprogram-pit.md" target="_blank" title="编辑" rel="noopener"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-edit-line"></use></svg></a></h1><div class="post-meta"><div class="post-time" style="display:block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2020-05-21 00:00:00" itemprop="dateCreated datePublished" datetime="2020-05-21T00:00:00+00:00">2020-05-21</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="修改时间：2021-09-27 06:34:37" itemprop="dateModified" datetime="2021-09-27T06:34:37+00:00">2021-09-27</time></div><span class="post-count"><span class="post-symbolcount"><span class="post-meta-item-icon" title="本文字数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-file-word-line"></use></svg></span> <span title="本文字数">2.4k</span><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读时长"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-timer-line"></use></svg></span> <span title="阅读时长">10m</span></span></span><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">小程序</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">小程序</span></a></span></div><div class="post-author"><span class="author-name">toshiba</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><p>最近连续开发了几个小程序，总是有一些需要重复解决的问题，因此在此记录一下</p>
<h3 id="自定义头部组件"><a href="#自定义头部组件" class="headerlink" title="自定义头部组件"></a>自定义头部组件</h3><p>我们开发小程序的时候通常是用的统一的头部，一般是白底黑字或者简单定义一下背景色和文字颜色，比如这样<br>在 <code>page/example.json</code> 中定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;usingComponents&quot;: &#123;&#125;,</span><br><span class="line">  &quot;navigationBarBackgroundColor&quot;: &quot;#557dde&quot;,</span><br><span class="line">  &quot;navigationBarTitleText&quot;: &quot;二维码收款&quot;,</span><br><span class="line">  &quot;navigationBarTextStyle&quot;: &quot;white&quot;,</span><br><span class="line">  &quot;backgroundColor&quot;: &quot;#557dde&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>同时在<code>page/example.wxss</code> 中定义背景色</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page &#123;</span><br><span class="line">  background-color: #557dde;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下<br><img src="https://cdn.darknights.cn/assets/images/in-post/miniprogram/code.png" loading="lazy"></p>
<p>同时定义了顶部状态栏的颜色和背景栏的颜色，通常也能够满足需求了。</p>
<p>但是仅仅这样是不够的比如我想像这样<br><img src="https://cdn.darknights.cn/assets/images/in-post/miniprogram/example1.png" loading="lazy"><br>头部图片可以做滑动效果而且展开到整个头部。这时候就需要自定义组件出马了,比如在首页 index.json 中要引入自定义组建</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;enablePullDownRefresh&quot;: false,</span><br><span class="line">  &quot;onReachBottomDistance&quot;: 50,</span><br><span class="line">  &quot;navigationStyle&quot;: &quot;custom&quot;,</span><br><span class="line">  &quot;usingComponents&quot;: &#123;</span><br><span class="line">    &quot;nav-bar&quot;: &quot;/component/navbar/navbar&quot;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中最关键的点就是要计算状态栏的各种高度，首先头部导航包括两部分工具栏和 title 栏<br><img src="https://cdn.darknights.cn/assets/images/in-post/miniprogram/navigator.png" loading="lazy"><br>其中上部分是工具栏通过小程序提供的<code>wx.getSystemInfoSync()</code>方法能够拿到系统的一些信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  SDKVersion: &quot;2.11.3&quot;,</span><br><span class="line">  batteryLevel: 100,</span><br><span class="line">  benchmarkLevel: 1,</span><br><span class="line">  brand: &quot;devtools&quot;,</span><br><span class="line">  deviceOrientation: &quot;portrait&quot;,</span><br><span class="line">  devicePixelRatio: 2,</span><br><span class="line">  fontSizeSetting: 16,</span><br><span class="line">  language: &quot;zh_CN&quot;,</span><br><span class="line">  model: &quot;iPhone 6/7/8&quot;,</span><br><span class="line">  pixelRatio: 2,</span><br><span class="line">  platform: &quot;devtools&quot;,</span><br><span class="line">  safeArea: &#123;</span><br><span class="line">    bottom: 667,</span><br><span class="line">    height: 647,</span><br><span class="line">    left: 0,</span><br><span class="line">    right: 375,</span><br><span class="line">    top: 20,</span><br><span class="line">    width: 375</span><br><span class="line">  &#125;,</span><br><span class="line">  screenHeight: 667,</span><br><span class="line">  screenWidth: 375,</span><br><span class="line">  statusBarHeight: 20,</span><br><span class="line">  system: &quot;iOS 10.0.1&quot;,</span><br><span class="line">  version: &quot;7.0.4&quot;,</span><br><span class="line">  windowHeight: 603,</span><br><span class="line">  windowWidth: 375,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>一般情况下 <code>screenHeight - windowHeight</code> 所得到的就是顶部工具栏+title 栏的高度， 但是在自定义了头部组件后即设置了<code>"navigationStyle": "custom"</code>，这两个值是相等的,还有一个比较重要的字段 statusBarHeight 通常这个就是代表工具栏的高度而且这个值是值得信赖的。 有个点需要注意就是单位一定要设置为<code>px</code>。</p>
<blockquote>
<p>注：由于胶囊按钮是原生组件，为表现一致，其单位在各种手机中都为 px，所以我们自定义导航栏的单位都必需是 px（切记不能用 rpx），才能完美适配。</p>
</blockquote>
<p>解决了工具栏部分，主要需要搞定的就是 title 栏的高度了，主要是为了适配胶囊的位置。<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/design/#%E5%9B%BE%E6%A0%87">官方文档</a>，有一张图片<br><img src="https://cdn.darknights.cn/assets/images/in-post/miniprogram/bar.png" loading="lazy"><br>这里安卓跟 ios 的表现是不一样的,胶囊距离工具栏的高度是不一样的，差了 6 个 pt，更闹心的是开发工具跟真机的表现也是不一样的， 不过好在一点就是胶囊的宽和高是一样的都是<code>87</code>*<code>32</code>，我们所做的一切努力都是想让胶囊的上下间距跟跟不自定义组件的显示效果是一样的</p>
<blockquote>
<p>真机和开发者工具模拟器上的胶囊按钮不一样</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># iOS</span><br><span class="line">	top 4px</span><br><span class="line">	right 7px</span><br><span class="line">	width 87px</span><br><span class="line">	height 32px</span><br><span class="line"></span><br><span class="line"># Android</span><br><span class="line">	top 8px</span><br><span class="line">	right 10px</span><br><span class="line">	width 95px</span><br><span class="line">	height 32px</span><br><span class="line"></span><br><span class="line"># 开发者工具模拟器（iOS）</span><br><span class="line">	top 6px</span><br><span class="line">	right 10px</span><br><span class="line">	width 87px</span><br><span class="line">	height 32px</span><br><span class="line"></span><br><span class="line"># 开发者工具模拟器（Android）</span><br><span class="line">	top 8px</span><br><span class="line">	right 10px</span><br><span class="line">	width 87px</span><br><span class="line">	height 32px</span><br><span class="line"></span><br><span class="line">可以看出，iOS胶囊按钮与状态栏之间距离为：4px， Android为8px，是不是所有手机都是这种情况呢？</span><br><span class="line">答案是:苹果手机确实都是4px,安卓大部分都是7和8 也会有其他的情况</span><br><span class="line">(可以自己打印getSystemInfo验证)如何快速便捷算出这个高度,请接着往下看</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="粗暴计算方法一"><a href="#粗暴计算方法一" class="headerlink" title="粗暴计算方法一"></a>粗暴计算方法一</h4><p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/article/doc/000aa842274d58cb15f74f81f56013">自定义导航栏所有机型的适配方案</a>,简单粗暴根据上面规律来计算胶囊的位置</p>
<p><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/s/Q79g6kmo7w5J">代码片段</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * 获取胶囊按钮位置</span><br><span class="line">   */</span><br><span class="line">  getMenuPosition () &#123;</span><br><span class="line">    let top = 4</span><br><span class="line">    let right = 7</span><br><span class="line">    let width = 87</span><br><span class="line">    let height = 32</span><br><span class="line">    if (systemInfo.platform === &#x27;devtools&#x27; &amp;&amp; systemInfo.system.indexOf(&#x27;Android&#x27;) === -1) &#123;</span><br><span class="line">      top = 6</span><br><span class="line">      right = 10</span><br><span class="line">    &#125;</span><br><span class="line">    else if (systemInfo.platform === &#x27;devtools&#x27; &amp;&amp; systemInfo.system.indexOf(&#x27;Android&#x27;) != -1) &#123;</span><br><span class="line">      top = 8</span><br><span class="line">      right = 10</span><br><span class="line">    &#125;</span><br><span class="line">    else if (systemInfo.system.indexOf(&#x27;Android&#x27;) != -1) &#123;</span><br><span class="line">      top = 8</span><br><span class="line">      right = 10</span><br><span class="line">      width = 95</span><br><span class="line">    &#125;</span><br><span class="line">    return &#123;</span><br><span class="line">      top: systemInfo.statusBarHeight + top,</span><br><span class="line">      left: systemInfo.windowWidth - width - right,</span><br><span class="line">      width: width,</span><br><span class="line">      height: height</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">   * 获取工具栏样式</span><br><span class="line">   */</span><br><span class="line">  getStatusBarStyle () &#123;</span><br><span class="line">    let statusBarPosition = &#123;</span><br><span class="line">      top: 0,</span><br><span class="line">      left: 0,</span><br><span class="line">      width: systemInfo.windowWidth,</span><br><span class="line">      height: systemInfo.statusBarHeight</span><br><span class="line">    &#125;</span><br><span class="line">    return this.formatStyle(statusBarPosition)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">   /**</span><br><span class="line">   * 获取导航栏样式</span><br><span class="line">   */</span><br><span class="line">  getNavigationBarStyle () &#123;</span><br><span class="line">    let menuPosition = this.getMenuPosition()</span><br><span class="line">    let navigationBarPosition = &#123;</span><br><span class="line">      top: systemInfo.statusBarHeight,</span><br><span class="line">      left: 0,</span><br><span class="line">      width: systemInfo.windowWidth,</span><br><span class="line">      height: (menuPosition.top - systemInfo.statusBarHeight) * 2 + menuPosition.height</span><br><span class="line">    &#125;</span><br><span class="line">    return this.formatStyle(navigationBarPosition)</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 获取导航样式</span><br><span class="line">   */</span><br><span class="line">  getNavigationStyle () &#123;</span><br><span class="line">    let menuPosition = this.getMenuPosition()</span><br><span class="line">    let padding = systemInfo.windowWidth - menuPosition.left - menuPosition.width</span><br><span class="line">    let navigationPosition = &#123;</span><br><span class="line">      top: menuPosition.top,</span><br><span class="line">      left: padding,</span><br><span class="line">      width: systemInfo.windowWidth - padding * 3 - menuPosition.width,</span><br><span class="line">      height: menuPosition.height</span><br><span class="line">    &#125;</span><br><span class="line">    return this.formatStyle(navigationPosition)</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 获取胶囊按钮样式</span><br><span class="line">   */</span><br><span class="line">  getMenuStyle() &#123;</span><br><span class="line">    return this.formatStyle(this.getMenuPosition())</span><br><span class="line">  &#125;,</span><br><span class="line">  /**</span><br><span class="line">   * 格式化Style</span><br><span class="line">   */</span><br><span class="line">  formatStyle (position) &#123;</span><br><span class="line">    let styles = []</span><br><span class="line">    for (let key in position) &#123;</span><br><span class="line">      styles.push(`$&#123;key&#125;: $&#123;position[key]&#125;px;`)</span><br><span class="line">    &#125;</span><br><span class="line">    return styles.join(&#x27; &#x27;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wxml 文件如下</span><br><span class="line"></span><br><span class="line">&lt;view&gt;</span><br><span class="line">  &lt;!-- status-bar --&gt;</span><br><span class="line">  &lt;view class=&quot;status-bar&quot; style=&quot;&#123;&#123; statusBarStyle &#125;&#125;&quot;/&gt;</span><br><span class="line">  &lt;!-- navigation-bar --&gt;</span><br><span class="line">  &lt;view class=&quot;navigation-bar&quot; style=&quot;&#123;&#123; navigationBarStyle &#125;&#125;&quot;&gt;</span><br><span class="line">    &lt;!-- title --&gt;</span><br><span class="line">    &lt;view class=&quot;navigation&quot; style=&quot;&#123;&#123; navigationStyle &#125;&#125;&quot;&gt;</span><br><span class="line">      这是最佳可操作区域</span><br><span class="line">    &lt;/view&gt;</span><br><span class="line">  &lt;/view&gt;</span><br><span class="line">  &lt;!-- menu --&gt;</span><br><span class="line">  &lt;view class=&quot;menu&quot; style=&quot;&#123;&#123; menuStyle &#125;&#125;&quot;/&gt;</span><br><span class="line">&lt;/view&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总结一下这种计算只是区分了最常规的几种显示方案，包括开发工具的安卓，开发工具的 IOS， 真机的安卓，真机的 IOS,只是囊括了最通用的显示方案，但是如果真机范围足够广的话应该会有问题，需要对出现问题的机型逐一兼容。</p>
<h4 id="拼多多-官方不稳的方案二"><a href="#拼多多-官方不稳的方案二" class="headerlink" title="拼多多+官方不稳的方案二"></a>拼多多+官方不稳的方案二</h4><p>其实官方提供了一个方法来获取胶囊的位置<br><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/api/ui/menu/wx.getMenuButtonBoundingClientRect.html">wx.getMenuButtonBoundingClientRect</a><br>,但是这个方法可能获取不到或者根本不准确<br>问题列表如下：<br><img src="https://cdn.darknights.cn/assets/images/in-post/miniprogram/error.png" loading="lazy"><br>到目前为止还是没有完美解决这个问题，所以该方法还是要慎重使用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">  const systemInfo = wx.getSystemInfoSync();</span><br><span class="line">  rect = wx.getMenuButtonBoundingClientRect ? wx.getMenuButtonBoundingClientRect() : null;</span><br><span class="line">  if (rect === null) &#123;</span><br><span class="line">    throw &#x27;getMenuButtonBoundingClientRect error&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">  //取值为0的情况</span><br><span class="line">  if (!rect.width) &#123;</span><br><span class="line">    throw &#x27;getMenuButtonBoundingClientRect error&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; catch (error) &#123;</span><br><span class="line">  let gap = &#x27;&#x27;; //胶囊按钮上下间距 使导航内容居中</span><br><span class="line">  let width = 96; //胶囊的宽度，android大部分96或者95，ios为88或者87</span><br><span class="line">  if (systemInfo.platform === &#x27;android&#x27;) &#123;</span><br><span class="line">    gap = 8;</span><br><span class="line">    width = 96;</span><br><span class="line">  &#125; else if (systemInfo.platform === &#x27;devtools&#x27;) &#123;</span><br><span class="line">    if (ios) &#123;</span><br><span class="line">      gap = 6; //开发工具中ios手机 5.5</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      gap = 8; //开发工具中android和其他手机 7.5</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    gap = 4;</span><br><span class="line">    width = 88;</span><br><span class="line">  &#125;</span><br><span class="line">  if (!systemInfo.statusBarHeight) &#123;</span><br><span class="line">    //开启wifi的情况下修复statusBarHeight值获取不到</span><br><span class="line">    systemInfo.statusBarHeight = systemInfo.screenHeight - systemInfo.windowHeight - 20;</span><br><span class="line">  &#125;</span><br><span class="line">  rect = &#123;</span><br><span class="line">    //获取不到胶囊信息就自定义重置一个</span><br><span class="line">    bottom: systemInfo.statusBarHeight + gap + 32,</span><br><span class="line">    height: 32,</span><br><span class="line">    left: systemInfo.windowWidth - width - 10,</span><br><span class="line">    right: systemInfo.windowWidth - 10,</span><br><span class="line">    top: systemInfo.statusBarHeight + gap,</span><br><span class="line">    width: width</span><br><span class="line">  &#125;;</span><br><span class="line">  console.log(&#x27;error&#x27;, error);</span><br><span class="line">  console.log(&#x27;rect&#x27;, rect);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>通过兼容官方的<code>wx.getMenuButtonBoundingClientRect</code>方法，再加上方法一中的设定默认值的方案基本就能满足所有场景了。</p>
<h3 id="swiper-高度问题"><a href="#swiper-高度问题" class="headerlink" title="swiper 高度问题"></a>swiper 高度问题</h3><p>我们开发时还有这样一个问题比如我们需要使用<code>swiper</code>组件，但是问题就是， swiper 中的内容高度是 100%的，这样如果在 swiper 中同时有上滑加载更多<br>就会有内容显示不全的问题，为了解决这个问题我用的方法一是动态调整 swiper 内容的高度，代码如下</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;swiper  style=&quot;width:100%; height: &#123;\&#123;swiperHeight px;&#125;\&#125;&quot; &gt;</span><br><span class="line">    &lt;block wx:for=&quot;&#123;&#123;types&#125;&#125;&quot; wx:key=&quot;*this&quot; wx:for-item=&quot;currentType&quot;&gt;</span><br><span class="line">      &lt;swiper-item&gt;</span><br><span class="line">        &lt;view id=&quot;start_view&quot; class=&quot;start-view&quot; wx:if=&quot;&#123;&#123;couponType ===  currentType&#125;&#125;&quot;&gt;&lt;/view&gt;</span><br><span class="line">        &lt;view class=&quot;tips-con&quot; wx:if=&quot;&#123;&#123;!emptyLoading &amp;&amp; !hasPosition &amp;&amp;  couponType === &#x27;nearby&#x27;&#125;&#125;&quot;&gt;</span><br><span class="line">          &lt;view class=&quot;tips-item&quot;&gt;若小程序定位已开启&lt;/view&gt;</span><br><span class="line">          &lt;view class=&quot;tips-item&quot;&gt;请进入系统“设置”-“隐私”-“定位服务”中打开开关&lt;/view&gt;</span><br><span class="line">          &lt;view class=&quot;tips-item&quot;&gt;允许使用定位系统&lt;/view&gt;</span><br><span class="line">          &lt;view class=&quot;btn open-setting-btn&quot; bindtap=&quot;openSetting&quot; wx:if=&quot;&#123;&#123;!hasPosition &amp;&amp;  couponType === &#x27;nearby&#x27;&#125;&#125;&quot;&gt;</span><br><span class="line">            开启定位</span><br><span class="line">          &lt;/view&gt;</span><br><span class="line">        &lt;/view&gt;</span><br><span class="line">        &lt;view id=&quot;end_view&quot; class=&quot;start-view&quot; wx:if=&quot;&#123;&#123;couponType ===currentType &#125;&#125;&quot;&gt;&lt;/view&gt;</span><br><span class="line">      &lt;/swiper-item&gt;</span><br><span class="line">    &lt;/block&gt;</span><br><span class="line">  &lt;/swiper&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其中<code>swiperHeight</code>是动态参数， 我们在请求拿到数据后，通过 <code>setData(&#123; list,&#125;) </code>之后，获取 <code>start_view</code> 和 <code>end_view</code> 之间内容的高度来重新计算高度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">autoHeight() &#123;</span><br><span class="line">    wx.createSelectorQuery()</span><br><span class="line"></span><br><span class="line">      .select(&quot;#end_view&quot;)</span><br><span class="line">      .boundingClientRect()</span><br><span class="line"></span><br><span class="line">      .select(&quot;#start_view&quot;)</span><br><span class="line">      .boundingClientRect()</span><br><span class="line">      .exec((rect) =&gt; &#123;</span><br><span class="line">        let _space = rect[0].top - rect[1].top;</span><br><span class="line"></span><br><span class="line">        this.setData(&#123;</span><br><span class="line">          swiperHeight: _space,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>方法一我们只是用了<code>swiper</code>组件，另一种实现方式是同时使用 <code>swiper</code> 和 <code>scroll</code>，<br>计算可视内容高度然后将 scroll 设置成固定高度，向上拖动自动追加新内容，只需要计算一次</p>
<h3 id="统一请求拦截"><a href="#统一请求拦截" class="headerlink" title="统一请求拦截"></a>统一请求拦截</h3><p>小程序发送请求我们会使用<code>wx.request</code>，如果需要设置统一的<code>Content-Type</code>或者在<code>headers</code>带上<code>token</code>， 就需要将请求封装</p>
<h2 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h2><ul>
<li><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/miniprogram/dev/framework/">官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d2748486fb9a07ed2249914">小程序之自定义头部导航栏</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5d557e2e5188255af1619716">微信小程序自定义导航栏组件(完美适配所有手机),可自定义实现任何你想要的功能</a></li>
<li><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/article/doc/000aa842274d58cb15f74f81f56013">自定义导航栏所有机型的适配方案</a></li>
<li><a target="_blank" rel="noopener" href="https://developers.weixin.qq.com/community/develop/article/doc/00048e5ed784b037b959757385b413">小程序顶部自定义导航组件实现原理及坑分享</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5ca0c4fc51882567ba6a6422#heading-3">小程序自定义导航栏适配（完美版）</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5b496d5d5188251a90187635#heading-8">【微信小程序】性能优化</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/post/5e56762fe51d45271a03a2e6">小程序订阅消息用户拒绝/关闭后，如何引导用户再次开启？并获得用户的操作状态？</a></li>
</ul>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>toshiba</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://sdongzhi.com/2020/05/21/miniprogram-pit/" title="小程序开发填坑">https://sdongzhi.com/2020/05/21/miniprogram-pit/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020/10/12/vscode-quick/" rel="prev" title="VSCode使用指南"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">VSCode使用指南</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020/04/24/babel-config/" rel="next" title="Babel最简单配置"><span class="post-nav-text">Babel最简单配置</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>若您想及时得到回复提醒，建议跳转 GitHub Issues 评论。</span><br></div><div id="disqus_thread"></div><script>const disqusConfig = function() {
  this.page.url = "https://sdongzhi.com/2020/05/21/miniprogram-pit/"; // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = "2020/05/21/miniprogram-pit/"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  this.page.title = "小程序开发填坑";
};
function loadDisqus() {
  // here we will only load the disqus <script> if not already loaded
  if (!window.DISQUS) {
    (function() {
      // DON'T EDIT BELOW THIS LINE
      const d = document,
        s = d.createElement("script");
      s.src = "https://IORI.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  }
  // if disqus <script> is already loaded, we just reset disqus the right way
  // see https://help.disqus.com/developer/using-disqus-on-ajax-sites
  else {
    DISQUS.reset({
      reload: true,
      config: function() {
        this.page.identifier = disqusConfig.page.identifier;
        this.page.url = disqusConfig.page.url;
      },
    });
  }
}</script><script src="/js/comments/disqus.js"></script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2017 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> 多弗朗明哥</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" href="javascript:;" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a><script>window.addEventListener("DOMContentLoaded", () => {
  // Handle and trigger popup window
  document.querySelector(".popup-trigger").addEventListener("click", () => {
    document.querySelector(".popup").classList.add("show");
    setTimeout(() => {
      document.querySelector(".search-input").focus();
    }, 100);
  });

  // Monitor main search box
  const onPopupClose = () => {
    document.querySelector(".popup").classList.remove("show");
  };

  document.querySelector(".popup-btn-close").addEventListener("click", () => {
    onPopupClose();
  });

  window.addEventListener("keyup", event => {
    if (event.key === "Escape") {
      onPopupClose();
    }
  });
});
</script><script defer src="https://cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script><script defer src="https://cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script><script defer src="/js/search/algolia-search.js"></script><div class="popup search-popup"><div class="search-header"><span class="popup-btn-close close-icon hty-icon-button"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-close-line"></use></svg></span></div><div class="search-input-container"></div><div class="algolia-results"><div id="algolia-stats"></div><div id="algolia-hits"></div><div class="algolia-pagination" id="algolia-pagination"></div></div></div></div><!-- hexo injector body_end start --><script src="https://cdn.jsdelivr.net/npm/hexo-tag-common@latest/js/index.js"></script><!-- hexo injector body_end end --></body></html>